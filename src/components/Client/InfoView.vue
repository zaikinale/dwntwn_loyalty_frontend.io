<template>
  <div class="card">
    <h3>–ê–¥—Ä–µ—Å–∞ –∫–æ—Ñ–µ–µ–Ω</h3>
    <div class="locations">
      <a
        href="https://yandex.ru/maps/-/CLRijYmL"
        target="_blank"
        rel="noopener noreferrer"
        class="location-link"
      >
        —É–ª. –ö–∞–∑–∞–Ω—Å–∫–∞—è, 25
      </a>
      <a
        href="https://yandex.ru/maps/-/CLRifK3C"
        target="_blank"
        rel="noopener noreferrer"
        class="location-link"
      >
        —É–ª. –ú–∞–ª–∞—è –ú–æ—Ä—Å–∫–∞—è, 18
      </a>
    </div>
  </div>

  <div class="card">
    <h3>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
    <a
      href="https://t.me/dwntwn_coffee_support_bot"
      target="_blank"
      rel="noopener noreferrer"
      class="support-link"
    >
      –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram!<br>
      @dwntwn_coffee_support_bot
    </a>
  </div>

  <div class="card">
    <h3>–ú—ã –≤ Instagram</h3>
    <a
      href="https://instagram.com/dwntwn_coffee"
      target="_blank"
      rel="noopener noreferrer"
      class="social-link"
    >
      @dwntwn_coffee
    </a>
  </div>

  <div class="card">
    <h3>–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
    <p class="rules-text">
      ‚Ä¢ –ó–∞ –∫–∞–∂–¥—É—é –ø–æ–∫—É–ø–∫—É –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –±–æ–Ω—É—Å—ã<br />
      ‚Ä¢ 1 –±–æ–Ω—É—Å = 1 —Ä—É–±–ª—å<br />
      ‚Ä¢ –ë–æ–Ω—É—Å—ã –º–æ–∂–Ω–æ –æ–±–º–µ–Ω—è—Ç—å –Ω–∞ –Ω–∞–ø–∏—Ç–∫–∏ –∏ –¥–µ—Å–µ—Ä—Ç—ã
    </p>
  </div>

  <div class="card">
    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º</h3>
    <button class="leave-button" @click="leaveLoyaltyProgram">–ü–æ–∫–∏–Ω—É—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</button>
  </div>
</template>


<script setup>
import { ref } from 'vue'

const leaveLoyaltyProgram = async () => {
  const confirmed = confirm(
    '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏?\n' +
    '–í—Å–µ –≤–∞—à–∏ –±–æ–Ω—É—Å—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã, –Ω–æ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–Ω–æ–≤–∞.'
  )
  if (!confirmed) return

  const initData = window.Telegram?.WebApp?.initData
  if (!initData) {
    alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏.')
    return
  }

  try {
    const response = await fetch(`${window.API_BASE}/api/client/delete-account`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ initData })
    })

    const data = await response.json()

    if (response.ok) {
      // üí° –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –≤—ã–π—Ç–∏ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è "–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"
      alert('–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏!\n–ú—ã –≤—Å–µ–≥–¥–∞ –±—É–¥–µ–º —Ä–∞–¥—ã –≤–∞–º —Å–Ω–æ–≤–∞!')
      window.location.reload()
    } else {
      alert('–û—à–∏–±–∫–∞: ' + (data.detail || '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç'))
    }
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞:', err)
    alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.')
  }
}
</script>


<style scoped>
.card {
  background: #111;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  color: white;
}
.card h3 {
  margin-bottom: 10px;
  color: white;
}
.location-link,
.social-link,
.support-link {
  display: block;
  color: #4da6ff;
  text-decoration: none;
  margin-bottom: 8px;
  line-height: 1.4;
}
.location-link:last-child,
.social-link:last-child,
.support-link:last-child {
  margin-bottom: 0;
}
.location-link:hover,
.social-link:hover,
.support-link:hover {
  color: #1a8cff;
  text-decoration: underline;
}
.rules-text {
  line-height: 1.6;
  font-size: 14px;
  margin: 0;
  color: inherit;
}

.leave-button {
  background: #e53935;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: background 0.2s;
  width: 100%;
  text-align: center;
}
.leave-button:hover {
  background: #c62828;
}
</style>